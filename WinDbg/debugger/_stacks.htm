<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="The !stacks extension displays information about the kernel stacks."/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>!stacks</title>

<meta name="MS-HAID" content="r29_exts_kernel_Q_e8bc89db-0e90-49e2-9899-99461f099edf.xml"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="debugger._stacks"></a>!stacks</h1>
</div>
<p>The <b>!stacks</b> extension displays information about the kernel stacks.</p>
<p>Syntax</p>
<pre class="syntax"><b>!stacks </b>[<i>Detail</i> [<i>FilterString</i>]] </pre>
<h2><a id="ddk__stacks_dbg"></a><a id="DDK__STACKS_DBG"></a>Parameters</h2>
<p></p>
<dl>
<dt><a id="_______Detail______"></a><a id="_______detail______"></a><a id="_______DETAIL______"></a>       <i>Detail</i>      </dt>
<dd>
<p>Specifies the level of detail to use in the display. The following table lists the valid values for <i>Detail</i>.
  </p>
<table>
<tr>
<td>
<p>
          0
        </p>
</td>
<td>
<p>Displays a summary of the current kernel stacks. This is the default value.</p>
</td>
</tr>
<tr>
<td>
<p>
          1
        </p>
</td>
<td>
<p>Displays stacks that are currently paged out, as well as the current kernel stacks.</p>
</td>
</tr>
<tr>
<td>
<p>
          2
        </p>
</td>
<td>
<p>Displays the full parameters for all stacks, as well as stacks that are currently paged out and the current kernel stacks.</p>
</td>
</tr>
</table>
<p> </p>
</dd>
<dt><a id="_______FilterString______"></a><a id="_______filterstring______"></a><a id="_______FILTERSTRING______"></a>       <i>FilterString</i>      </dt>
<dd>
<p> Displays only threads that contain the specified substring in a symbol. </p>
</dd>
</dl>
<h3><a id="DLL"></a><a id="dll"></a>DLL</h3>
<p>
          Kdexts.dll
         </p>
<h3><a id="Additional_Information"></a><a id="additional_information"></a><a id="ADDITIONAL_INFORMATION"></a>Additional Information</h3>
<p>For information about kernel stacks, see <i>Microsoft Windows Internals</i>, by Mark Russinovich and David Solomon. (This book may not be available in some languages and 

countries.)</p>
<h2>Remarks</h2>
<p>The <b>!stacks</b> extension gives a brief summary of the state of every thread. You can use this extension instead of the <a href="_process.htm"><b>!process</b></a> extension to get a quick overview of the system, especially when debugging multithread issues such as resource conflicts or deadlocks.</p>
<p>The <a href="_findstack.htm"><b>!findstack</b></a> user-mode extension also displays information about particular stacks.</p>
<p>Here is an example of the simplest <b>!stacks</b> display:</p>
<pre class="syntax" xml:space="preserve"><code>kd&gt; !stacks 0
Proc.Thread  .Thread  ThreadState  Blocker
                                     [System]
   4.000050  827eea10  Blocked    +0xfe0343a5

                                     [smss.exe]

                                     [csrss.exe]
  b0.0000a8  82723b70  Blocked    ntoskrnl!_KiSystemService+0xc4
  b0.0000c8  82719620  Blocked    ntoskrnl!_KiSystemService+0xc4
  b0.0000d0  827d5d50  Blocked    ntoskrnl!_KiSystemService+0xc4
.....</code></pre>
<p>The first column shows the process ID and the thread ID (separated by a period).</p>
<p>The second column is the current address of the thread's ETHREAD block.</p>
<p>The third column shows the state of the thread (initialized, ready, running, standby, terminated, transition, or blocked).</p>
<p>The fourth column shows the top address on the thread's stack.</p>
<p>Here are examples of more detailed <b>!stacks</b> output:</p>
<pre class="syntax" xml:space="preserve"><code>kd&gt; !stacks 1
Proc.Thread  .Thread  ThreadState  Blocker
                                     [System]
   4.000008  827d0030  Blocked    ntoskrnl!MmZeroPageThread+0x66
   4.000010  827d0430  Blocked    ntoskrnl!ExpWorkerThread+0x189
   4.000014  827cf030  Blocked    Stack paged out
   4.000018  827cfda0  Blocked    Stack paged out
   4.00001c  827cfb10  Blocked    ntoskrnl!ExpWorkerThread+0x189
.....
                                     [smss.exe]
  9c.000098  82738310  Blocked    Stack paged out
  9c.0000a0  826a5190  Blocked    Stack paged out
  9c.0000a4  82739d30  Blocked    Stack paged out

                                     [csrss.exe]
  b0.0000bc  826d0030  Blocked    Stack paged out
  b0.0000b4  826c9030  Blocked    Stack paged out
  b0.0000a8  82723b70  Blocked    ntoskrnl!_KiSystemService+0xc4
.....

kd&gt; !stacks 2
Proc.Thread  .Thread  ThreadState  Blocker
                                     [System]
   4.000008  827d0030  Blocked    ntoskrnl!KiSwapThread+0xc5
                                  ntoskrnl!KeWaitForMultipleObjects+0x2b4
                                  ntoskrnl!MmZeroPageThread+0x66
                                  ntoskrnl!Phase1Initialization+0xd82
                                  ntoskrnl!PspSystemThreadStartup+0x4d
                                  ntoskrnl!CreateSystemRootLink+0x3d8
                                  +0x3f3f3f3f
   4.000010  827d0430  Blocked    ntoskrnl!KiSwapThread+0xc5
                                  ntoskrnl!KeRemoveQueue+0x191
.....</code></pre>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [debugger\debugger]:%20!stacks%20 RELEASE:%20(3/16/2017)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
