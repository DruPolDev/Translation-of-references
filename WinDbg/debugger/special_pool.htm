<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Special Pool"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Special Pool</title>

<meta name="MS-HAID" content="GFlags_49d59420-7de8-4925-8f99-7ee0e8acd8ec.xml"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="debugger.special_pool"></a>Special Pool</h1>
</div>
<p>The <b>Special Pool</b> feature configures Windows to request memory allocations from a reserved memory pool when the memory is allocated with a specified pool tag or is within a specified size range. </p>
<table>
<tr>
<td>
<p><b>Abbreviation</b></p>
</td>
<td>
<p>spp</p>
</td>
</tr>
<tr>
<td>
<p><b>Hexadecimal value
       </b></p>
</td>
<td>
<p>(None)</p>
</td>
</tr>
<tr>
<td>
<p><b>Symbolic Name</b></p>
</td>
<td>
<p>(None)</p>
</td>
</tr>
<tr>
<td>
<p><b>Destination</b></p>
</td>
<td>
<p>System-wide registry entry</p>
<p>(Windows Vista and later)  System-wide registry entry, kernel flag</p>
</td>
</tr>
</table>
<p> </p>
<h3><a id="selecting_a_pool_tag"></a><a id="SELECTING_A_POOL_TAG"></a>Selecting a Pool Tag</h3>
<p>When requesting special pool for a particular pool tag, make sure that your driver or other kernel-mode program uses a unique pool tag.</p>
<p>Also, when creating a pool tag (such as by using <b>ExAllocatePoolWithTag</b>), consider entering the tag characters in reverse order. For example, if the tag is <b>Fred</b>, consider entering it as <b>derF</b> (0x64657246). Pool tags are stored in the registry and displayed in the debugger and other tools in reverse (lower endian) order. If you enter them in reverse order, they are displayed in forward order (0x46726564)</p>
<p>If you suspect that your driver is consuming all of the special pool, consider using multiple pool tags in your code. You can then test your driver several times, assigning special pool to one pool tag in each test.</p>
<p>Also, select a pool tag with a hexadecimal value that is greater than the page size of the system. For kernel mode code, if you enter a pool tag that has a value less than PAGE_SIZE, Gflags requests special pool for all allocations whose size is within the corresponding range <u>and</u> requests special pool for allocations with an equivalent pool tag. For example, if you select a size of <b>30</b>, special pool will be used for all allocations between 17 and 32 bytes in size, <u>and</u> for allocations with the pool tag 0x0030.</p>
<h3><a id="selecting_an_allocation_size"></a><a id="SELECTING_AN_ALLOCATION_SIZE"></a>Selecting an Allocation Size</h3>
<p>Use the following guidelines to select an allocation size for the Special Pool feature.</p>
<p>On a computer with an x86 processor, PAGE_SIZE is 0x1000 and the allocation size ranges are 8 bytes in length. To configure the Special Pool feature for all allocations with sizes in this range, enter a number equal to the maximum of this range plus 8. (This number is always a multiple of 8.) The following table illustrates these values:</p>
<table>
<tr>
<th>Size range</th>
<th>Enter this number</th>
</tr>
<tr>
<td>
<p>1 to 8 bytes</p>
</td>
<td>
<p>10  (decimal 16)</p>
</td>
</tr>
<tr>
<td>
<p>9 to 16 bytes</p>
</td>
<td>
<p>18  (decimal 24)</p>
</td>
</tr>
<tr>
<td>
<p>17 to 24 bytes</p>
</td>
<td>
<p>20  (decimal 32)</p>
</td>
</tr>
<tr>
<td>
<p>...
       </p>
</td>
<td>
<p>...
       </p>
</td>
</tr>
<tr>
<td>
<p>0xFE9 to 0xFF0 bytes</p>
</td>
<td>
<p>FF8  (decimal 4088)</p>
</td>
</tr>
</table>
<p> </p>
<p>On a computer with an AMD x86-64 processor, PAGE_SIZE is 0x1000 and the allocation size ranges are 16 bytes in length. To configure the Special Pool feature for all allocations with sizes in this range, enter a number equal to the maximum of this range plus 16. (This number is always a multiple of 16.) The following table illustrates these values:</p>
<table>
<tr>
<th>Size range</th>
<th>Enter this number</th>
</tr>
<tr>
<td>
<p>1 to 16 bytes</p>
</td>
<td>
<p>20  (decimal 32)</p>
</td>
</tr>
<tr>
<td>
<p>17 to 32 bytes</p>
</td>
<td>
<p>30  (decimal 48)</p>
</td>
</tr>
<tr>
<td>
<p>33 to 48 bytes</p>
</td>
<td>
<p>40  (decimal 64)</p>
</td>
</tr>
<tr>
<td>
<p>...
       </p>
</td>
<td>
<p>...
       </p>
</td>
</tr>
<tr>
<td>
<p>0xFD1 to 0xFE0 bytes</p>
</td>
<td>
<p>FF0  (decimal 4080)</p>
</td>
</tr>
</table>
<p> </p>
<p>On a computer with any processor, you can use an asterisk ( <b>*</b> ) or 0x2A (decimal 42) to configure the Special Pool feature for all memory allocations on the system.</p>
<h3><a id="comments"></a><a id="COMMENTS"></a>Comments</h3>
<p>For information about configuring the Special Pool feature in the Global Flags Dialog Box, see <a href="configuring_special_pool.htm">Configuring Special Pool</a>. For information about configuring the Special Pool feature at the command line, see <a href="gflags_commands.htm"><b>GFlags Commands</b></a>. For an example, see <a href="example_14___configuring_special_pool.htm">Example 14:  Configuring Special Pool</a>.</p>
<p>The Special Pool feature of Gflags directs Windows to request memory allocations from a reserved memory pool when the memory is allocated with a specified pool tag or is within a specified size range. To request special pool for all allocations by a particular driver, use Driver Verifier. For more information, see the "Special Pool" topic in the "Driver Verifier" section of the Windows Driver Kit (WDK).</p>
<p>The special pool features of Gflags and Driver Verifier help you to detect and identify the source of errors in kernel pool use, such as writing beyond the allocated memory space, or referring to memory that has already been freed.</p>
<p>Not all special pool requests are fulfilled. Each allocation from the special pool uses one page of nonpageable physical memory and two pages of virtual address space. If the special pool is exhausted, memory is allocated from the standard pool until the special pool becomes available again. When a special pool request is filled from the standard pool, the requesting function returns a success status. It does not return an error, because the allocation has succeeded, even though it was not filled from special pool.</p>
<p>The size of the special pool increases with the amount of physical memory on the system; ideally this should be at least 1 Gigabyte (GB). On x86 machines, because virtual (in addition to physical) space is consumed, do not use the <b>/3GB</b> boot option when using special pool. It is also a good idea to increase the pagefile minimum/maximum quantities by a factor of two or three.</p>
<p>You can also configure the Special Pool feature to align memory allocation to detect references to memory preceding the allocation ("underruns") or references to memory beyond the allocation ("overruns"). This feature is available only in the Global Flags dialog box on all versions of Windows. For details, see <a href="detecting_overruns_and_underruns.htm">Detecting Overruns and Underruns</a>.</p>
<p>On Windows Vista and later versions of Windows, you can configure the Special Pool feature as a registry setting that requires a reboot, but remains effective until you change it, or as a kernel flag setting that does not require a reboot, but is effective only until you reboot or shut down Windows. In earlier versions of Windows, Special Pool is only available as a registry setting.</p>
<p>On Windows Vista and later versions of Windows, you can configure the Special Pool feature either by using the Global Flags dialog box or at the command line. In earlier version of Windows, this feature is available only in the Global Flags dialog box.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [debugger\debugger]:%20Special Pool%20 RELEASE:%20(3/16/2017)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
