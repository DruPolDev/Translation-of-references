<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Debugging WinLogon"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Debugging WinLogon</title>

<meta name="MS-HAID" content="t13_advanced_09c005ad-497f-42d2-8791-38b23d024562.xml"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="debugger.debugging_winlogon"></a>Debugging WinLogon</h1>
</div>
<h2><a id="ddk_debugging_winlogon_with_ntsd_dbg"></a><a id="DDK_DEBUGGING_WINLOGON_WITH_NTSD_DBG"></a></h2>
<p>WinLogon is the user-mode process that handles the task of interactive users logging on and logging off, and handles all instances of CTRL+ALT+DELETE.</p>
<h3><a id="controlling_ntsd_from_the_kernel_debugger"></a><a id="CONTROLLING_NTSD_FROM_THE_KERNEL_DEBUGGER"></a>Controlling NTSD from the Kernel Debugger</h3>
<p>The easiest way to debug WinLogon is to use NTSD and <a href="controlling_the_user_mode_debugger_from_the_kernel_debugger.htm">control it from the kernel debugger</a>.  </p>
<h3><a id="enabling_winlogon_debugging"></a><a id="ENABLING_WINLOGON_DEBUGGING"></a>Enabling WinLogon Debugging</h3>
<p>Because you will be redirecting the user-mode debugger output to the kernel debugger, you will need to set up a kernel debugging connection. See <a href="getting_set_up_for_debugging.htm">Getting Set Up for Debugging</a>.</p>
<p>To attach a debugger to WinLogon, you must go through the registry so the process is debugged from the time it starts up. To set up WinLogon debugging, set <b>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\WinLogon.EXE\Debugger</b> to:</p>
<pre class="syntax" xml:space="preserve"><code>ntsd -d -x -g </code></pre>
<p>The <b>-d</b> option passes control to the kernel debugger. The <b>-x</b> option causes the debugger to capture access violations as second-chance exceptions.  The <b>-g</b> option causes the WinLogon process to run after the attachment. Do not add the <b>-g</b> if you want to start debugging before Winlogon.exe begins (for example, if you want to set an initial breakpoint).</p>
<p>In addition, you should set the GlobalFlag value under the <b>winlogon.exe</b> key to REG_DWORD "0x000400F0". This sets heap checking and FLG_ENABLE_KDEBUG_SYMBOL_LOAD. However, since this second flag only affects the kernel debugger, symbols must also be copied to the target computer before starting the debugger. </p>
<p>The registry change requires a reboot to take effect.</p>
<h3><a id="performing_the_debugging"></a><a id="PERFORMING_THE_DEBUGGING"></a>Performing the Debugging</h3>
<p>After the next reboot, the debugger will break into WinLogon automatically.</p>
<p>See <a href="controlling_the_user_mode_debugger_from_the_kernel_debugger.htm">Controlling the User-Mode Debugger from the Kernel Debugger</a> for an explanation of how to proceed.</p>
<p>You will have to set  your symbol path to a location on your host computer or to some other location on your network. When WinLogon is being debugged, network authentication on the target computer will not work properly.</p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [debugger\debugger]:%20Debugging WinLogon%20 RELEASE:%20(3/16/2017)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
