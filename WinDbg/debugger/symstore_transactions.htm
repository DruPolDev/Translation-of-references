<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="SymStore Transactions"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>SymStore Transactions</title>

<meta name="MS-HAID" content="r09_symbols_5bd468fd-48a8-468c-86f8-ff48c13f3c9c.xml"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="debugger.symstore_transactions"></a>SymStore Transactions</h1>
</div>
<h2><a id="ddk_symbol_files_overview_dbg"></a><a id="DDK_SYMBOL_FILES_OVERVIEW_DBG"></a></h2>
<p>Every call to SymStore is recorded as a transaction. There are two types of transactions: add and delete.</p>
<p>When the symbol store is created, a directory, called "000admin", is created under the root of the server. The 000admin directory contains one file for each transaction, as well as the log files server.txt and history.txt. The server.txt file contains a list of all transactions that are currently on the server. The history.txt file contains a chronological history of all transactions.</p>
<p>Each time SymStore stores or removes symbol files, a new transaction number is created. Then, a file, whose name is this transaction number, is created in 000admin. This file contains a list of all the files or pointers that have been added to the symbol store during this transaction. If a transaction is deleted, SymStore will read through its transaction file to determine which files and pointers it should delete. </p>
<p>The <b>add</b> and <b>del</b> options specify whether an add or delete transaction is to be performed. Including the <b>/p</b> option with an add operation specifies that a pointer is to be added; omitting the <b>/p</b> option specifies that the actual symbol file is to be added.</p>
<p>It is also possible to create the symbol store in two separate stages. In the first stage, you use SymStore with the <b>/x</b> option to create an index file. In the second stage, you use SymStore with the <b>/y</b> option to create the actual store of files or pointers from the information in the index file.</p>
<p>This can be a useful technique for a variety of reasons. For instance, this allows the symbol store to be easily recreated if the store is somehow lost, as long as the index file still exists. Or perhaps the computer containing the symbol files has a slow network connection to the computer on which the symbol store will be created. In this case, you can create the index file on the same machine as the symbol files, transfer the index file to the second machine, and then create the store on the second machine. </p>
<p>For a full listing of all SymStore parameters, see <a href="symstore_command_line_options.htm"><b>SymStore Command-Line Options</b></a>.</p>
<div class="alert"><b>Note</b>    SymStore does not support simultaneous transactions from multiple users. It is recommended that one user be designated "administrator" of the symbol store and be responsible for all <b>add</b> and <b>del</b> transactions.</div>
<div> </div>
<h3><a id="transaction_examples"></a><a id="TRANSACTION_EXAMPLES"></a>Transaction Examples</h3>
<p>Here are two examples of SymStore adding symbol pointers for build 2195 of Windows 2000 to \\MyDir\symsrv:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>symstore add /r /p /f \\BuildServer\BuildShare\2195free\symbols\*.* /s \\MyDir\symsrv /t "Windows 2000" /v "Build 2195 x86 free" /c "Sample add"
symstore add /r /p /f \\BuildServer\BuildShare\2195free\symbols\*.* /s \\MyDir\symsrv /t "Windows 2000" /v "Build 2195 x86 checked" /c "Sample add"</pre>
</td>
</tr>
</table></span></div>
<p>In the following example, SymStore adds the actual symbol files for an application project in \\largeapp\appserver\bins to \\MyDir\symsrv:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>symstore add /r /f \\largeapp\appserver\bins\*.* /s \\MyDir\symsrv /t "Large Application" /v "Build 432" /c "Sample add"</pre>
</td>
</tr>
</table></span></div>
<p>Here is an example of how an index file is used. First, SymStore creates an index file based on the collection of symbol files in \\largeapp\appserver\bins\. In this case, the index file is placed on a third computer, \\hubserver\hubshare. You use the <b>/g</b> option to specify that the file prefix "\\largeapp\appserver" might change in the future:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>symstore add /r /p /g \\largeapp\appserver /f \\largeapp\appserver\bins\*.* /x \\hubserver\hubshare\myindex.txt</pre>
</td>
</tr>
</table></span></div>
<p>Now suppose you move all the symbol files off of the machine \\largeapp\appserver and put them on \\myarchive\appserver. You can then create the symbol store itself from the index file \\hubserver\hubshare\myindex.txt as follows:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>symstore add /y \\hubserver\hubshare\myindex.txt /g \\myarchive\appserver /s \\MyDir\symsrv /p /t "Large Application" /v "Build 432" /c "Sample Add from Index"</pre>
</td>
</tr>
</table></span></div>
<p>Finally, here is an example of SymStore deleting a file added by a previous transaction. See "The server.txt and history.txt Files" section below for an explanation of how to determine the transaction ID (in this case, 0000000096).</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>symstore del /i 0000000096 /s \\MyDir\symsrv</pre>
</td>
</tr>
</table></span></div>
<h3><a id="the_server_txt_and_history_txt_files"></a><a id="THE_SERVER_TXT_AND_HISTORY_TXT_FILES"></a>The server.txt and history.txt Files</h3>
<p>When a transaction is added, several items of information are added to server.txt and history.txt for future lookup capability. The following is an example of a line in server.txt and history.txt for an add transaction:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>0000000096,add,ptr,10/09/99,00:08:32,Windows Vista SP 1,x86 fre 1.156c-RTM-2,Added from \\mybuilds\symbols,</pre>
</td>
</tr>
</table></span></div>
<p>This is a comma-separated line. The fields are explained as follows:</p>
<table>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
<tr>
<td>
<p>0000000096</p>
</td>
<td>
<p>Transaction ID number, as created by SymStore.</p>
</td>
</tr>
<tr>
<td>
<p>add</p>
</td>
<td>
<p>Type of transaction. This field can be either <b>add</b> or <b>del</b>.</p>
</td>
</tr>
<tr>
<td>
<p>ptr</p>
</td>
<td>
<p>Whether files or pointers were added. This field can be either <b>file</b> or <b>ptr</b>.</p>
</td>
</tr>
<tr>
<td>
<p>10/09/99</p>
</td>
<td>
<p>Date when transaction occurred.</p>
</td>
</tr>
<tr>
<td>
<p>00:08:32</p>
</td>
<td>
<p>Time when transaction started.</p>
</td>
</tr>
<tr>
<td>
<p>Windows Vista SP 1</p>
</td>
<td>
<p>Product.</p>
</td>
</tr>
<tr>
<td>
<p>x86 fre</p>
</td>
<td>
<p>Version (optional).</p>
</td>
</tr>
<tr>
<td>
<p>Added from</p>
</td>
<td>
<p>Comment (optional)</p>
</td>
</tr>
<tr>
<td>
<p>Unused </p>
</td>
<td>
<p>(Reserved for later use.)</p>
</td>
</tr>
</table>
<p> </p>
<p>Here are some sample lines from the transaction file 0000000096. Each line records the directory and the location of the file or pointer that was added to the directory.</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>canon800.dbg\35d9fd51b000,\\mybuilds\symbols\sp4\dll\canon800.dbg
canonlbp.dbg\35d9fd521c000,\\mybuilds\symbols\sp4\dll\canonlbp.dbg
certadm.dbg\352bf2f48000,\\mybuilds\symbols\sp4\dll\certadm.dbg
certcli.dbg\352bf2f1b000,\\mybuilds\symbols\sp4\dll\certcli.dbg
certcrpt.dbg\352bf04911000,\\mybuilds\symbols\sp4\dll\certcrpt.dbg
certenc.dbg\352bf2f7f000,\\mybuilds\symbols\sp4\dll\certenc.dbg</pre>
</td>
</tr>
</table></span></div>
<p>If you use a <b>del</b> transaction to undo the original <b>add</b> transactions, these lines will be removed from server.txt, and the following line will be added to history.txt:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>0000000105,del,0000000096</pre>
</td>
</tr>
</table></span></div>
<p>The fields for the delete transaction are described as follows.</p>
<table>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
<tr>
<td>
<p>0000000105</p>
</td>
<td>
<p>Transaction ID number, as created by SymStore.</p>
</td>
</tr>
<tr>
<td>
<p>del</p>
</td>
<td>
<p>Type of transaction. This field can be either <b>add</b> or <b>del</b>.</p>
</td>
</tr>
<tr>
<td>
<p>0000000096</p>
</td>
<td>
<p>Transaction that was deleted.</p>
</td>
</tr>
</table>
<p> </p>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [debugger\debugger]:%20SymStore Transactions%20 RELEASE:%20(3/16/2017)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
