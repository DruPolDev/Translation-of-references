<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="You can use Microsoft Visual Studio to set up and perform kernel-mode debugging over a USB 3.0 cable."/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Setting Up Kernel-Mode Debugging over a USB 3.0 Cable in Visual Studio</title>



<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="debugger.setting_up_a_usb_3_0_cable_connection_in_visual_studio"></a>Setting Up Kernel-Mode Debugging over a USB 3.0 Cable in Visual Studio</h1>
</div>
<p>You can use Microsoft Visual Studio to set up and perform kernel-mode debugging over a USB 3.0 cable. To use Visual Studio for kernel-mode debugging, you must have the Windows Driver Kit (WDK) integrated with Visual Studio. For information about how to install the integrated environment, see <a href="http://go.microsoft.com/fwlink/p?linkid=301383">Windows Driver Development</a>.</p>
<p>As an alternative to using Visual Studio to set up USB 3.0 debugging, you can do the setup manually. For more information, see <a href="setting_up_a_usb_3_0_debug_cable_connection.htm">Setting Up Kernel-Mode Debugging over a USB 3.0 Cable Manually</a>.</p>
<p>The computer that runs the debugger is called the <i>host computer</i>, and the computer that is being debugged is called the <i>target computer</i>. </p>
<p>Debugging over a USB 3.0 connection requires the following hardware:</p>
<ul>
<li>
<p>A USB 3.0 debug cable. This is an A-A crossover cable that has only the USB 3.0 lines and no Vbus.</p>
</li>
<li>
<p>On the host computer, an xHCI (USB 3.0) host controller</p>
</li>
<li>
<p>On the target computer, an xHCI (USB 3.0) host controller that supports debugging</p>
</li>
</ul>
<h2><a id="setting_up_the_computer_usb3_manual"></a><a id="SETTING_UP_THE_COMPUTER_USB3_MANUAL"></a>Identifying a Debug Port on the Target Computer</h2>
<ol>
<li>On the target computer, launch the UsbView tool. The UsbView tool is included in Debugging Tools for Windows.</li>
<li>In UsbView, locate all of the xHCI host controllers.</li>
<li>
<p>In UsbView, expand the nodes of the xHCI host controllers. Look for an indication that a port on the host controller supports debugging.</p>
<pre class="syntax" xml:space="preserve"><code>[Port1] 

Is Port User Connectable:         yes
Is Port Debug Capable:            yes
Companion Port Number:            3
Companion Hub Symbolic Link Name: USB#ROOT_HUB30#5&amp;32bab638&amp;0&amp;0#{...}
Protocols Supported:
 USB 1.1:                         no
 USB 2.0:                         no
 USB 3.0:                         yes</code></pre>
</li>
<li>
<p>Make a note of the bus, device, and function numbers for the xHCI controller that you intend to use for debugging. UsbView displays these number. In the following example, the bus number is 48, the device number is 0, and the function number is 0. </p>
<pre class="syntax" xml:space="preserve"><code>USB xHCI Compliant Host Controller
...
DriverKey: {36fc9e60-c465-11cf-8056-444553540000}\0020
...
Bus.Device.Function (in decimal): 48.0.0</code></pre>
</li>
<li>After you have identified an xHCI controller that supports debugging, the next step is to locate the physical USB connector that is associated with a port on the xHCI controller. To find the physical connector, plug any USB 3.0 device into any USB connector on the target computer. Refresh UsbView to see where your  device is located. If UsbView shows your device connected to the xHCI host controller, then you have found a physical USB connector that you can use for USB 3.0 debugging.</li>
</ol>
<h2><a id="Configuring_the_host_and_target_computers"></a><a id="configuring_the_host_and_target_computers"></a><a id="CONFIGURING_THE_HOST_AND_TARGET_COMPUTERS"></a>Configuring the host and target computers</h2>
<ol>
<li>Begin configuring your host and target computers as described in Provision a computer for driver deployment and testing (WDK 8.1).</li>
<li>On the host computer, in Visual Studio, when you come to the Computer Configuration dialog box, select <b>Provision computer and choose debugger settings</b>.</li>
<li>
<p>For <b>Connection Type</b>, choose <b>USB</b>.</p><img src="images/SetupUsbVs.png" alt="Screen shot showing an example of debugger settings with values for the following fields: Connection Type, Target Name, and Bus Parameters"/><p>For <b>Target Name</b>, enter a string to represent the target computer. This string does not have to be the official name of the target computer; it can be any string that you create as long as it meets these restrictions:</p>
<ul>
<li>The maximum length of the string is 24 characters.</li>
<li>The only characters in the string are the hyphen (-), the underscore(_), the digits 0 through 9, and the letters A through Z (upper or lower case).</li>
</ul>
<p>If you have more than one USB host controller on the target computer, enter a <b>Bus Parameters</b> value of <i>b</i>.<i>d</i>.<i>f</i>, where <i>b</i>, <i>d</i>, and <i>f</i> are the bus, device, and function numbers for the USB host controller that you intend to use for debugging on the target computer. The bus, device, and function numbers must be in decimal format (example: 48.0.0).</p>
</li>
<li>The configuration process takes several minutes and might automatically reboot the target computer once or twice. When the process is complete, click <b>Finish</b>.</li>
</ol>
<h2><a id="Verifying_dbgsettings_on_the_Target_Computer"></a><a id="verifying_dbgsettings_on_the_target_computer"></a><a id="VERIFYING_DBGSETTINGS_ON_THE_TARGET_COMPUTER"></a>Verifying dbgsettings on the Target Computer</h2>
<p>On the target computer, open a Command Prompt window as Administrator, and enter these commands:</p>
<p><b>bcdedit /dbgsettings</b></p>
<p><b>bcdedit /enum</b></p>
<pre class="syntax" xml:space="preserve"><code>...
targetname              MyUsbTarget
debugtype               USB
debugport               1
baudrate                115200
...
busparams               48.0.0</code></pre>
<p>Verify that <i>debugtype</i>  is USB and <i>targetname</i> is the name you specified in Visual Studio on the host comptuer. You can ignore the values of <i>debugport</i> and <i>baudrate</i>; they do not apply to debugging over USB.</p>
<p>If you entered <b>Bus Parameters</b> in Visual Studio, verify that <i>busparams</i> matches the bus parameters you specified.</p>
<p>If you do not see the value you entered for <b>Bus Parameters</b>, enter this command:</p>
<p><b>bcdedit /set "{dbgsettings}" busparams </b><i>b</i><b>.</b><i>d</i><b>.</b><i>f</i></p>
<p>where <i>b</i>, <i>d</i>, and <i>f</i> are the bus, device, and function numbers of the xHCI controller on the target computer that you have chosen to use for debugging.</p>
<p>Example:</p>
<p><b>bcdedit /set "{dbgsettings}" busparams 48.0.0</b></p>
<p>Reboot the target computer.</p>
<h2><a id="Starting_a_Debugging_Session_for_the_First_Time"></a><a id="starting_a_debugging_session_for_the_first_time"></a><a id="STARTING_A_DEBUGGING_SESSION_FOR_THE_FIRST_TIME"></a>Starting a Debugging Session for the First Time</h2>
<ol>
<li>Connect a Universal Serial Bus (USB) 3.0 debug cable to the USB 3.0 ports that you have chosen for debugging on the host and target computers.</li>
<li>On the host computer, open Visual Studio as Administrator.</li>
<li>On the <b>Tools</b> menu, choose <b>Attach to Process</b>.</li>
<li>For <b>Transport</b>, choose <b>Windows Kernel Mode Debugger</b>.</li>
<li>For <b>Qualifier</b>, select the name of the target computer that you previously configured.</li>
<li>Click <b>Attach</b>.</li>
</ol>
<p>At this point, the USB debug driver gets installed on the host computer. This is why it is important to run Visual Studio as Administrator. After the USB debug driver is installed, you do not need to run as Administrator for subsequent debugging sessions.</p>
<h2><a id="starting_the_debugging_session_usb3_vs"></a><a id="STARTING_THE_DEBUGGING_SESSION_USB3_VS"></a>Starting a Debugging Session</h2>
<ol>
<li>On the host computer, in Visual Studio, on the <b>Tools</b> menu, choose <b>Attach to Process</b>.</li>
<li>For <b>Transport</b>, choose <b>Windows Kernel Mode Debugger</b>.</li>
<li>For <b>Qualifier</b>, select the name of the target computer that you previously configured.</li>
<li>Click <b>Attach</b>.</li>
</ol>
<h2><a id="Troubleshooting_tips_for_debugging_over_USB_3.0"></a><a id="troubleshooting_tips_for_debugging_over_usb_3.0"></a><a id="TROUBLESHOOTING_TIPS_FOR_DEBUGGING_OVER_USB_3.0"></a>Troubleshooting tips for debugging over USB 3.0</h2>
<p>In some cases, power transitions can interfere with debugging over USB 3.0. If you have this problem, disable selective suspend for the xHCI host controller (and its root hub) that you are using for debugging.</p>
<ol>
<li>In Device Manager, navigate to the node for the xHCI host controller. Right click the node, and choose <b>Properties</b>. If there is a <b>Power Management</b> tab, open the tab, and clear the <b> Allow the computer to turn off this device to save power</b> check box.</li>
<li>In Device Manager, navigate to the node for the root hub of the xHCI host controller. Right click the node, and choose <b>Properties</b>. If there is a <b>Power Management</b> tab, open the tab, and clear the <b> Allow the computer to turn off this device to save power</b> check box.</li>
</ol>
<p>When you have finished using the xHCI host controller for debugging, enable selective suspend for the xHCI host controller.</p>
<h2><a id="related_topics"></a>Related topics</h2>
<dl>
<dt><a href="setting_up_kernel-mode_debugging_in_visual_studio.htm">Setting Up Kernel-Mode Debugging in Visual Studio</a></dt>
</dl>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [debugger\debugger]:%20Setting Up Kernel-Mode Debugging over a USB 3.0 Cable in Visual Studio%20 RELEASE:%20(3/16/2017)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
