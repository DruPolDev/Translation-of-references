<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="Description" content="Live Local Debugging"/>
<meta name="MSHAttr" content="PreferredSiteName:MSDN"/>
<meta name="MSHAttr" content="PreferredLib:/library/windows/hardware"/>
<title>Live Local Debugging</title>

<meta name="MS-HAID" content="t11~b_ks_7075b69d-1f58-48d7-9ca1-eb8a61e59c16.xml"/>


<link rel="STYLESHEET" type="text/css" HREF="../common/backsdk4.css"/>


</head>
<body>

<div id="mainSection">
<div class="clsServerSDKContent">
<h1><a id="debugger.live_local_debugging"></a>Live Local Debugging</h1>
</div>
<p>In Microsoft Windows XP and later operating systems, it is possible to do local kernel debugging by starting the kernel debugger (KD) or WinDbg with the <b>-kl</b>  command line option:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>kd [-y SymbolPath] -kl </pre>
</td>
</tr>
</table></span></div>
<p>or</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>windbg [-y SymbolPath] -kl </pre>
</td>
</tr>
</table></span></div>
<p>In Windows Vista and later, local kernel debugging requires the computer to be booted with the <b>/debug</b> option. Open a Command Prompt Window as Administrator, and enter <b>bcdedit /debug on</b>. Reboot the computer.</p>
<p>In Windows Vista and later, local kernel debugging requires the debugger to be run as Administrator.</p>
<p>Live local debugging is extremely useful for debugging issues that are difficult to reproduce when the debugger is attached; however, anything that requires knowledge of time sensitive information, including packet, IRP, and SRB data, is unlikely to work unless the problem is a hang or a stall.</p>
<p>When performing local debugging, consider the following variables:</p>
<ul>
<li>
<p><b>Overall states.</b>  For example, is the stream running? Is the stream paused? </p>
</li>
<li>
<p><b>Packet counts.</b>  For example, are there IRPs queued to the stream?</p>
</li>
<li>
<p><b>Changes in packet counts.</b>  Is the stream moving?</p>
</li>
<li>
<p><b>Changes in packet lists.</b></p>
</li>
<li>
<p><b>Hung kernel threads.</b></p>
</li>
</ul>
<p>Consider the last of these.</p>
<h3><a id="examining_a_hung_thread_in_lkd"></a><a id="EXAMINING_A_HUNG_THREAD_IN_LKD"></a>Examining a Hung Thread in LKD</h3>
<p>First, use the <a href="_process.htm"><b>!process 0 0</b></a> extension to identify the process containing the hung thread. Then, issue <b>!process</b> again for more information about that thread:</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>lkd&gt; !process 816a550 7
        THREAD 81705da8  Cid 0b5c.0b60  Teb: 7ffde000 Win32Thread: e1b2d890 WAIT: (Suspended)
        IRP List:
            816c9ad8: (0006,0190) Flags: 00000030  Mdl: 00000000
        Start Address kernel32!BaseProcessStartThunk (0x77e5c650)
        Win32 Start Address 0x0101c9be
        Stack Init f50bf000 Current f50bea74 Base f50bf000 Limit f50b9000 Call 0
        Priority 10 BasePriority 8 PriorityDecrement 0</pre>
</td>
</tr>
</table></span></div>
<p>The threads are not displayed, but the stack addresses are.  Using the <a href="dds__dps__dqs__display_words_and_symbols_.htm"><b>dds</b></a> (or <b>ddq</b>) command on the current address on the stack yields a starting point for further investigation, because it specifies which process is calling.</p>
<div class="code"><span codelanguage=""><table>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>lkd&gt; dds f50bea74
f50bea74  f50bebc4
f50bea78  00000000
f50bea7c  80805795 nt!KiSwapContext+0x25
f50beab4  8080ece0 nt!KeWaitForSingleObject
f50beabc  f942afda ks!CKsQueue::CancelAllIrps+0x14
f50bead8  f94406c4 ks!CKsQueue::SetDeviceState+0x170
f50beb00  f943f6f1 ks!CKsPipeSection::DistributeDeviceStateChange+0x1d
f50beb24  f943fb1e ks!CKsPipeSection::SetDeviceState+0xb2</pre>
</td>
</tr>
</table></span></div>
<p> </p>
<p> </p>
<p><a href="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [debugger\debugger]:%20Live Local Debugging%20 RELEASE:%20(3/16/2017)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AWe use your feedback to improve the documentation. We don't use your email address for any other purpose, and we'll remove your email address from our system after the issue that you're reporting is fixed. While we're working to fix this issue, we might send you an email message to ask for more info. Later, we might also send you an email message to let you know that we've addressed your feedback.%0A%0AFor more info about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." title="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft</a></p>
</div>
<p style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&#x00a9;&#x00a0;2016 Microsoft. All rights reserved.</p>

</body>
</html>
