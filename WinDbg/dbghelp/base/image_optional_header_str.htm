<HTML xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:mssdk="winsdk" xmlns:script="urn:script" xmlns:script2="urn:script2" xmlns:build="urn:build" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:ApiRef="http://msdn.microsoft.com/apiref">
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<TITLE>IMAGE_OPTIONAL_HEADER Structure</TITLE><META NAME="MS-HAID" CONTENT="_win32_image_optional_header_str">
<!-- Built on Tuesday, September 25, 2007 -->
<LINK REL="STYLESHEET" TYPE="text/css" HREF="../common/backsdk4.css"/>
<SCRIPT SRC="../common/langref.js"></SCRIPT>
</HEAD>
<BODY TOPMARGIN="0">
<DIV class="clsServerSDKContent">
<H1><A NAME="base.image_optional_header_str"></A>IMAGE_OPTIONAL_HEADER Structure</H1>
<P><P>Represents the optional header format.</P>
</P>
<PRE class="syntax" xml:space="preserve">typedef struct _IMAGE_OPTIONAL_HEADER {<br>  WORD Magic;<br>  BYTE MajorLinkerVersion;<br>  BYTE MinorLinkerVersion;<br>  DWORD SizeOfCode;<br>  DWORD SizeOfInitializedData;<br>  DWORD SizeOfUninitializedData;<br>  DWORD AddressOfEntryPoint;<br>  DWORD BaseOfCode;<br>  DWORD BaseOfData;<br>  DWORD ImageBase;<br>  DWORD SectionAlignment;<br>  DWORD FileAlignment;<br>  WORD MajorOperatingSystemVersion;<br>  WORD MinorOperatingSystemVersion;<br>  WORD MajorImageVersion;<br>  WORD MinorImageVersion;<br>  WORD MajorSubsystemVersion;<br>  WORD MinorSubsystemVersion;<br>  DWORD Win32VersionValue;<br>  DWORD SizeOfImage;<br>  DWORD SizeOfHeaders;<br>  DWORD CheckSum;<br>  WORD Subsystem;<br>  WORD DllCharacteristics;<br>  DWORD SizeOfStackReserve;<br>  DWORD SizeOfStackCommit;<br>  DWORD SizeOfHeapReserve;<br>  DWORD SizeOfHeapCommit;<br>  DWORD LoaderFlags;<br>  DWORD NumberOfRvaAndSizes;<br>  IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];
} IMAGE_OPTIONAL_HEADER, <br> *PIMAGE_OPTIONAL_HEADER;</PRE>
<H4>Members</H4>
<DL>
<DT><B>Magic</B></DT>
<DD><p>The state of the image file. This member can be one of the following values. 

</p>
<TABLE class="clsStd">
<TR>
<TH>Value</TH>
<TH>Meaning</TH>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_NT_OPTIONAL_HDR_MAGIC</p>
</TD>
<TD width="60%"><p>The file is an executable image. This value is defined as IMAGE_NT_OPTIONAL_HDR32_MAGIC in a 32-bit application and as IMAGE_NT_OPTIONAL_HDR64_MAGIC in a 64-bit application.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_NT_OPTIONAL_HDR32_MAGIC<BR>0x10b</p>
</TD>
<TD width="60%"><p>The file is an executable image.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_NT_OPTIONAL_HDR64_MAGIC<BR>0x20b</p>
</TD>
<TD width="60%"><p>The file is an executable image.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_ROM_OPTIONAL_HDR_MAGIC<BR>0x107</p>
</TD>
<TD width="60%"><p>The file is a ROM image.</p>
</TD>
</TR>
</TABLE>
</DD>
<DT><B>MajorLinkerVersion</B></DT>
<DD><p>The major version number of the linker.</p>
</DD>
<DT><B>MinorLinkerVersion</B></DT>
<DD><p>The minor version number of the linker.</p>
</DD>
<DT><B>SizeOfCode</B></DT>
<DD><p>The size of the code section, in bytes, or the sum of all such sections if there are multiple code sections.</p>
</DD>
<DT><B>SizeOfInitializedData</B></DT>
<DD><p>The size of the initialized data section, in bytes, or the sum of all such sections if there are multiple initialized data sections.</p>
</DD>
<DT><B>SizeOfUninitializedData</B></DT>
<DD><p>The size of the uninitialized data section, in bytes, or the sum of all such sections if there are multiple uninitialized data sections.</p>
</DD>
<DT><B>AddressOfEntryPoint</B></DT>
<DD><p>A pointer to the entry point function, relative to the image base address. For executable files, this is the starting address. For device drivers, this is the address of the initialization function. The entry point function is optional for DLLs. When no entry point is present, this member is zero.</p>
</DD>
<DT><B>BaseOfCode</B></DT>
<DD><p>A pointer to the beginning of the code section, relative to the image base.</p>
</DD>
<DT><B>BaseOfData</B></DT>
<DD><p>A pointer to the beginning of the data section, relative to the image base.</p>
</DD>
<DT><B>ImageBase</B></DT>
<DD><p>The preferred address of the first byte of the image when it is loaded in memory. This value is a multiple of 64K bytes. The default value for DLLs is 0x10000000. The default value for applications is 0x00400000, except on Windows CE where it is 0x00010000.</p>
</DD>
<DT><B>SectionAlignment</B></DT>
<DD><p>The alignment of sections loaded in memory, in bytes. This value must be greater than or equal to the <b>FileAlignment</b> member. The default value is the page size for the system.</p>
</DD>
<DT><B>FileAlignment</B></DT>
<DD><p>The alignment of the raw data of sections in the image file, in bytes. The value should be a power of 2 between 512 and 64K (inclusive). The default is 512. If the <b>SectionAlignment</b> member is less than the system page size, this member must be the same as <b>SectionAlignment</b>.</p>
</DD>
<DT><B>MajorOperatingSystemVersion</B></DT>
<DD><p>The major version number of the required operating system.</p>
</DD>
<DT><B>MinorOperatingSystemVersion</B></DT>
<DD><p>The minor version number of the required operating system.</p>
</DD>
<DT><B>MajorImageVersion</B></DT>
<DD><p>The major version number of the image.</p>
</DD>
<DT><B>MinorImageVersion</B></DT>
<DD><p>The minor version number of the image.</p>
</DD>
<DT><B>MajorSubsystemVersion</B></DT>
<DD><p>The major version number of the subsystem.</p>
</DD>
<DT><B>MinorSubsystemVersion</B></DT>
<DD><p>The minor version number of the subsystem.</p>
</DD>
<DT><B>Win32VersionValue</B></DT>
<DD><p>This member is reserved and must be 0.</p>
</DD>
<DT><B>SizeOfImage</B></DT>
<DD><p>The size of the image, in bytes, including all headers. Must be a multiple of <b>SectionAlignment</b>.</p>
</DD>
<DT><B>SizeOfHeaders</B></DT>
<DD><p>The combined size of the MS-DOS stub, the PE header, and the section headers, rounded to a multiple of the value specified in the <b>FileAlignment</b> member.</p>
</DD>
<DT><B>CheckSum</B></DT>
<DD><p>The image file checksum. The following files are validated at load time: all drivers, any DLL loaded at boot time, and any DLL loaded into a critical system process.</p>
</DD>
<DT><B>Subsystem</B></DT>
<DD><p>The subsystem required to run this image. The following values are defined. 

</p>
<TABLE class="clsStd">
<TR>
<TH>Value</TH>
<TH>Meaning</TH>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_UNKNOWN<BR>0</p>
</TD>
<TD width="60%"><p>Unknown subsystem.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_NATIVE<BR>1</p>
</TD>
<TD width="60%"><p>No subsystem required (device drivers and native system processes).</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_WINDOWS_GUI<BR>2</p>
</TD>
<TD width="60%"><p>Windows graphical user interface (GUI) subsystem.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_WINDOWS_CUI<BR>3</p>
</TD>
<TD width="60%"><p>Windows character-mode user interface (CUI) subsystem.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_OS2_CUI<BR>5</p>
</TD>
<TD width="60%"><p>OS/2 CUI subsystem.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_POSIX_CUI<BR>7</p>
</TD>
<TD width="60%"><p>POSIX CUI subsystem.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_WINDOWS_CE_GUI<BR>9</p>
</TD>
<TD width="60%"><p>Windows CE system.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_EFI_APPLICATION<BR>10</p>
</TD>
<TD width="60%"><p>Extensible Firmware Interface (EFI) application.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_EFI_BOOT_SERVICE_DRIVER<BR>11</p>
</TD>
<TD width="60%"><p>EFI driver with boot services.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_EFI_RUNTIME_DRIVER<BR>12</p>
</TD>
<TD width="60%"><p>EFI driver with run-time services.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_EFI_ROM<BR>13</p>
</TD>
<TD width="60%"><p>EFI ROM image.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_XBOX<BR>14</p>
</TD>
<TD width="60%"><p>Xbox system.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_SUBSYSTEM_WINDOWS_BOOT_APPLICATION<BR>16</p>
</TD>
<TD width="60%"><p>Boot application.</p>
</TD>
</TR>
</TABLE>
</DD>
<DT><B>DllCharacteristics</B></DT>
<DD><p>The DLL characteristics of the image. The following values are defined.</p>
<TABLE class="clsStd">
<TR>
<TH>Value</TH>
<TH>Meaning</TH>
</TR>
<TR>
<TD width="40%">
<p>0x0001</p>
</TD>
<TD width="60%"><p>Reserved.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>0x0002</p>
</TD>
<TD width="60%"><p>Reserved.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>0x0004</p>
</TD>
<TD width="60%"><p>Reserved.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>0x0008</p>
</TD>
<TD width="60%"><p>Reserved.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_DLL_CHARACTERISTICS_DYNAMIC_BASE<BR>0x0040</p>
</TD>
<TD width="60%"><p>The DLL can be relocated at load time.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_DLLCHARACTERISTICS_FORCE_INTEGRITY<BR>0x0080</p>
</TD>
<TD width="60%"><p>Code integrity checks are forced.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_DLLCHARACTERISTICS_NX_COMPAT<BR>0x0100</p>
</TD>
<TD width="60%"><p>The image is compatible with data execution prevention (DEP).</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_DLLCHARACTERISTICS_NO_ISOLATION<BR>0x0200</p>
</TD>
<TD width="60%"><p>The image is isolation aware, but should not be isolated.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_DLLCHARACTERISTICS_NO_SEH<BR>0x0400</p>
</TD>
<TD width="60%"><p>The image does not use structured exception handling (SEH). No handlers can be called in this image.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_DLLCHARACTERISTICS_NO_BIND<BR>0x0800</p>
</TD>
<TD width="60%"><p>Do not bind the image.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>0x1000</p>
</TD>
<TD width="60%"><p>Reserved.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_DLLCHARACTERISTICS_WDM_DRIVER<BR>0x2000</p>
</TD>
<TD width="60%"><p>A WDM driver.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>0x4000</p>
</TD>
<TD width="60%"><p>Reserved.</p>
</TD>
</TR>
<TR>
<TD width="40%">
<p>IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE<BR>0x8000</p>
</TD>
<TD width="60%"><p>The image is Terminal Server aware.</p>
</TD>
</TR>
</TABLE>
</DD>
<DT><B>SizeOfStackReserve</B></DT>
<DD><p>The number of bytes to reserve for the stack. Only the memory specified by the <b>SizeOfStackCommit</b> member is committed at load time; the rest is made available one page at a time until this reserve size is reached.</p>
</DD>
<DT><B>SizeOfStackCommit</B></DT>
<DD><p>The number of bytes to commit for the stack.</p>
</DD>
<DT><B>SizeOfHeapReserve</B></DT>
<DD><p>The number of bytes to reserve for the local heap. Only the memory specified by the <b>SizeOfHeapCommit</b> member is committed at load time; the rest is made available one page at a time until this reserve size is reached.</p>
</DD>
<DT><B>SizeOfHeapCommit</B></DT>
<DD><p>The number of bytes to commit for the local heap.</p>
</DD>
<DT><B>LoaderFlags</B></DT>
<DD><p>This member is obsolete.</p>
</DD>
<DT><B>NumberOfRvaAndSizes</B></DT>
<DD><p>The number of directory entries in the remainder of the optional header. Each entry describes a location and size.</p>
</DD>
<DT><B>DataDirectory</B></DT>
<DD><p>A pointer to the first 
<A HREF="image_data_directory_str.htm"><b>IMAGE_DATA_DIRECTORY</b></A> structure in the data directory.</p>
</DD>
</DL>
<H4>Remarks</H4>
<p>The number of directories is not fixed. Check the <b>NumberOfRvaAndSizes</b> member before looking for a specific directory.</p>
<p>The actual structure in Winnt.h is named <A><b>IMAGE_OPTIONAL_HEADER32</b></A> and <A><b>IMAGE_OPTIONAL_HEADER</b></A> is defined as <A><b>IMAGE_OPTIONAL_HEADER32</b></A>. However, if _WIN64 is defined,  then <A><b>IMAGE_OPTIONAL_HEADER</b></A> is defined as <A><b>IMAGE_OPTIONAL_HEADER64</b></A>. </p>
<DIV ID="newLanguageFilteredSection" CLASS="conditionalSection" development_language="C++">
<P></P><DIV class="codeSnippet"><PRE xml:space="preserve" class="syntax">typedef struct _IMAGE_OPTIONAL_HEADER64 {
 WORD        Magic;
 BYTE        MajorLinkerVersion;
 BYTE        MinorLinkerVersion;
 DWORD       SizeOfCode;
 DWORD       SizeOfInitializedData;
 DWORD       SizeOfUninitializedData;
 DWORD       AddressOfEntryPoint;
 DWORD       BaseOfCode;
 ULONGLONG   ImageBase;
 DWORD       SectionAlignment;
 DWORD       FileAlignment;
 WORD        MajorOperatingSystemVersion;
 WORD        MinorOperatingSystemVersion;
 WORD        MajorImageVersion;
 WORD        MinorImageVersion;
 WORD        MajorSubsystemVersion;
 WORD        MinorSubsystemVersion;
 DWORD       Win32VersionValue;
 DWORD       SizeOfImage;
 DWORD       SizeOfHeaders;
 DWORD       CheckSum;
 WORD        Subsystem;
 WORD        DllCharacteristics;
 ULONGLONG   SizeOfStackReserve;
 ULONGLONG   SizeOfStackCommit;
 ULONGLONG   SizeOfHeapReserve;
 ULONGLONG   SizeOfHeapCommit;
 DWORD       LoaderFlags;
 DWORD       NumberOfRvaAndSizes;
 IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];
} IMAGE_OPTIONAL_HEADER64, *PIMAGE_OPTIONAL_HEADER64;</PRE></DIV>
</DIV>
<H4>Requirements</H4>
<TABLE CLASS="psdkRequirements">
<TR>
<TH><P>Client</P></TH>
<TD><P>Requires Windows Vista, Windows XP, Windows 2000 Professional, Windows NT Workstation 4.0, Windows Me, Windows 98, or Windows 95.</P></TD>
</TR>
<TR>
<TH><P>Server</P></TH>
<TD><P>Requires Windows Server 2008, Windows Server 2003, Windows 2000 Server, or Windows NT Server 4.0.</P></TD>
</TR>
<TR>
<TH><P>Header</P></TH>
<TD>
<P>Declared in Winnt.h; include Windows.h.</P>
</TD>
</TR>
</TABLE>
<H4>See Also</H4>
<P><A HREF="imagehlp_structures.htm">ImageHlp Structures</A><BR><A HREF="image_data_directory_str.htm"><b>IMAGE_DATA_DIRECTORY</b></A></P><br><P><A HREF="mailto:wsddocfb@microsoft.com?subject=Documentation%20feedback [base]:%20IMAGE_OPTIONAL_HEADER%20 RELEASE:%20(9/25/2007)&amp;body=%0A%0APRIVACY STATEMENT%0A%0AThe SDK team uses the feedback submitted to improve the SDK documentation. We do not use your e-mail address for any other purpose. We will remove your e-mail address from our system after the issue you are reporting has been resolved. While we are working to resolve this issue, we may send you an e-mail message to request more information about your feedback. After the issues have been addressed, we may send you an e-mail message to let you know that your feedback has been addressed.%0A%0AFor more information about Microsoft's privacy policy, see http://privacy.microsoft.com/en-us/default.aspx." TITLE="Send comments about this topic to Microsoft">Send comments about this topic to Microsoft
       </A></P>
<P STYLE="font-family: Verdana,sans-serif;font-size:8pt">Build date: 9/25/2007</P>
</DIV>
<DIV CLASS="footer"><P>&nbsp;</P></DIV>
<P style="text-align:left;font-family:Arial,sanserif;font-size:100%;color:black">
&copy;&nbsp;2007 Microsoft Corporation. All rights reserved.</P>
</BODY>
</HTML>
